<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
 
<hibernate-mapping>
	<sql-query name="EoVirtualInvItemWmsQuery">
		<![CDATA[
SELECT EVII.EOVI_ID,
       EVII.CREATOR,
       EVII.CREATE_TIME,
       EVII.MODIFIER,
       EVII.MODIFY_TIME,
       EVII.REC_VER,
       EVII.REC_STATUS,
       EVII.ORG_ID,
       EVII.COMPANY_CODE,
       EVII.SITE_CODE,
       EVII.EOVI_OWNER_CODE,
       EVII.EOVI_OWNER_NAME,
       EVII.EOVI_SKU_CODE,
       EVII.EOVI_SKU_NAME,
       CCM.CDWS_SKU_NAME CDCM_NAME_CN,
       EVII.P_IN_QTY AS PIN_QTY,
       EVII.P_OUT_QTY AS POUT_QTY,
       EVII.V_IN_QTY AS VIN_QTY,
       EVII.V_OUT_QTY AS VOUT_QTY,
       EVII.EOVI_QTY,
       EVII.EOVI_ONWAY_QTY,
       EVII.EOVI_STAGE_QTY,
       EVII.EOVI_PA_QTY,
       EVII.EOVI_ALLOCATED_QTY,
       EVII.EOVI_ONHOLD_QTY,
       EVII.EOVI_QC_QTY,
       EVII.EOVI_WH_CODE,
       EVII.EOVI_LOT_NUM,
       EVII.EOVI_UNIT,
       EVII.EOVI_PRODUCTION_DATE,
       EVII.EOVI_PREALLOCATED_QTY,
       EVII.EOVI_LOTATT01,
       EVII.EOVI_LOTATT02,
       EVII.EOVI_LOTATT03,
       EVII.EOVI_LOTATT04,
       NVL(WM.CODE_ALIAS, T.CODE_ALIAS) AS EOVI_LOTATTNAME04,
       EVII.EOVI_LOTATT05,
       EVII.EOVI_LOTATT06,
       EVII.EOVI_LOTATT07,
       EVII.EOVI_LOTATT08,
       EVII.EOVI_LOTATT09,
       EVII.EOVI_LOTATT10,
       EVII.EOVI_LOTATT11,
       EVII.EOVI_LOTATT12,
       EVII.TIME_ZONE,
       EVII.DEF1,
       EVII.DEF2,
       EVII.DEF3,
       EVII.DEF4,
       EVII.DEF5,
       /*有效库存*/
       EVII.EOVI_QTY - EVII.P_OUT_QTY - EVII.V_OUT_QTY -
       EVII.EOVI_ONHOLD_QTY AS EFFECT_QTY,
       /*仓库*/
       CW.CDWH_NAME WH_NAME,
       /*分公司*/
       EC1.ESCO_COMPANY_NAME_CN COMPANY_NAME,
       /*平台*/
       EC2.ESCO_COMPANY_NAME_CN SITE_NAME,
       CCM.CDWS_CUST_MATERIAL_NO AS CUST_MATERIAL_NO,
       CCM.CDWS_SKU_NAME SKU_NAME,
       EC.EBCU_NAME_CN OWNER_NAME,
       NVL(CCM.CDWS_WIDTH * EVII.EOVI_QTY, 0) AS SUMWEIGHT,
       
       NVL(CCM.CDWS_CUBIC * EVII.EOVI_QTY, 0) AS SUMCUBE,
       EBMG.EBMG_NAME_CN /*商品类别名称*/

  FROM EO_VIRTUAL_INV_ITEM EVII

  LEFT JOIN CD_WAREHOUSE CW
    ON CW.WH_CODE = EVII.EOVI_WH_CODE

  LEFT JOIN ES_COMPANY EC1
    ON EC1.ESCO_COMPANY_NO = EVII.COMPANY_CODE

  LEFT JOIN ES_COMPANY EC2
    ON EC2.ESCO_COMPANY_NO = EVII.SITE_CODE

  LEFT JOIN EB_CUSTOMER EC
    ON EC.EBCU_CUSTOMER_NO = EVII.EOVI_OWNER_CODE

  LEFT JOIN CD_WH_SKU CCM
    ON EVII.EOVI_SKU_CODE = CCM.CDWS_SKU_CODE

  LEFT JOIN EB_MATERIAL_CLASSIFICATION EBMG
    ON CCM.CDWS_GROUP_CODE = EBMG.EBMG_CODE
   AND EBMG.REC_STATUS = 0

  LEFT JOIN (SELECT CODE_ID, CODE_ALIAS, OWNER_CODE FROM WM_CODE_MASTER) WM
    ON WM.OWNER_CODE = EVII.EOVI_OWNER_CODE
   AND WM.CODE_ID = EVII.EOVI_LOTATT04
  LEFT JOIN (SELECT EB.EBCD_CODE AS CODE_ID, EB.EBCD_NAME_CN AS CODE_ALIAS
               FROM EB_CODE_MASTER EB
              WHERE EBCD_DICTIONARY_TYPE = 'SYS_WM_QUALIFY') T
    ON T.CODE_ID = EVII.EOVI_LOTATT04

 WHERE 1 = 1
   AND (EVII.EOVI_QTY > 0 OR EVII.EOVI_ONHOLD_QTY > 0 OR EVII.P_IN_QTY > 0 OR
       EVII.P_OUT_QTY > 0 OR EVII.V_IN_QTY > 0 OR EVII.V_OUT_QTY > 0)

   <if dataAuthority != 'N'>
  AND <@dataFilter Table="HLS_ES_COMPANY_CODE" fiEld= "COMPANY_CODE" aLias="EOVI" />

   AND <@dataFilter Table="HLS_EB_CUSTOMER" fiEld= "EOVI_OWNER_CODE" aLias="EOVI" /> 
 </if>
<if isPlan = 'Y'>
 <<AND EVIOD.DOC_NO LIKE :docNo>>
 <<AND EVIOD.SKU_LINE_NO LIKE :skuLineNo>>
</if>
 
 <<AND EBMG.EBMG_CODE = :cdcmTypeCode  >>
 <<AND EVII.EOVI_ID LIKE :eoviId>>
 <<AND EVII.CREATOR LIKE :creator>>
 <<AND EVII.CREATE_TIME > :createTimeFrom>>
 <<AND EVII.CREATE_TIME <= :createTimeTo + 1>>
 <<AND EVII.MODIFIER LIKE :modifier>>
 <<AND EVII.MODIFY_TIME > :modifyTimeFrom>>
 <<AND EVII.MODIFY_TIME <= :modifyTimeTo + 1>>
 <<AND EVII.REC_VER LIKE :recVer>>
 <<AND EVII.REC_STATUS LIKE :recStatus>>
 <<AND EVII.ORG_ID LIKE :orgId>>
 <<AND EVII.COMPANY_CODE LIKE :companyCode>>
 <<AND EVII.SITE_CODE LIKE :siteCode>>
 <<AND EVII.SITE_NAME LIKE :siteName>>
 <<AND EVII.EOVI_OWNER_CODE LIKE :eoviOwnerCode>>
 <<AND EVII.EOVI_OWNER_NAME LIKE :eoviOwnerName>>
 <<AND EVII.EOVI_SKU_CODE LIKE :eoviSkuCode>>
 <<AND EVII.EOVI_SKU_NAME LIKE :eoviSkuName>>
 <<AND EVII.P_IN_QTY LIKE :pInQty>>
 <<AND EVII.P_OUT_QTY LIKE :pOutQty>>
 <<AND EVII.V_IN_QTY LIKE :vInQty>>
 <<AND EVII.V_OUT_QTY LIKE :vOutQty>>
 <<AND EVII.EOVI_QTY LIKE :eoviQty>>
 <<AND EVII.EOVI_ONWAY_QTY LIKE :eoviOnwayQty>>
 <<AND EVII.EOVI_STAGE_QTY LIKE :eoviStageQty>>
 <<AND EVII.EOVI_PA_QTY LIKE :eoviPaQty>>
 <<AND EVII.EOVI_ALLOCATED_QTY LIKE :eoviAllocatedQty>>
 <<AND EVII.EOVI_ONHOLD_QTY LIKE :eoviOnholdQty>>
 <<AND EVII.EOVI_QC_QTY LIKE :eoviQcQty>>
 <<AND EVII.EOVI_WH_CODE LIKE :eoviWhCode>>
 <<AND EVII.EOVI_LOT_NUM LIKE :eoviLotNum>>
 <<AND EVII.EOVI_UNIT LIKE :eoviUnit>>
 <<AND EVII.EOVI_PRODUCTION_DATE > :eoviProductionDateFrom>>
 <<AND EVII.EOVI_PRODUCTION_DATE <= :eoviProductionDateTo + 1>>
 <<AND EVII.EOVI_PREALLOCATED_QTY LIKE :eoviPreallocatedQty>>
 
 <<AND EVII.EOVI_LOTATT01 LIKE :eoviLotatt01>>
 <<AND EVII.EOVI_LOTATT02 LIKE :eoviLotatt02>>
 <<AND EVII.EOVI_LOTATT03 LIKE :eoviLotatt03>>
 <<AND nvl(EVII.EOVI_LOTATT04,'#') LIKE :eoviLotatt04>>
 <<AND nvl(EVII.EOVI_LOTATT05,'#') LIKE :eoviLotatt05>>
 <<AND nvl(EVII.EOVI_LOTATT06,'#') LIKE :eoviLotatt06>>
 <<AND nvl(EVII.EOVI_LOTATT07,'#') LIKE :eoviLotatt07>>
 <<AND nvl(EVII.EOVI_LOTATT08,'#') LIKE :eoviLotatt08>>
 <<AND nvl(EVII.EOVI_LOTATT09,'#') LIKE :eoviLotatt09>>
 <<AND nvl(EVII.EOVI_LOTATT10,'#') LIKE :eoviLotatt10>>
 <<AND nvl(EVII.EOVI_LOTATT11,'#') LIKE :eoviLotatt11>>
 <<AND nvl(EVII.EOVI_LOTATT12,'#') LIKE :eoviLotatt12>>
 <<AND EVII.TIME_ZONE LIKE :timeZone>>
 <<AND EVII.DEF1 LIKE :def1>>
 <<AND EVII.DEF2 LIKE :def2>>
 <<AND EVII.DEF3 LIKE :def3>>
 <<AND EVII.DEF4 LIKE :def4>>
 <<AND EVII.DEF5 LIKE :def5>>
 <<AND EVII.EOVI_WH_CODE IN (:whCodeNos)>>
 <<AND EVII.SITE_CODE IN (:siteCodeNos)>>
 <<AND EC.IS_GROUP_CUSTOMER LIKE :isGroupCustomer>>
 
 <<AND EC.Ebcu_Bu_Code = :ebcuBuCode>>
 <<AND EC.is_agent =:isAgent>>
 <<AND EC.is_sale_company =:isSaleCompany>>
  
 and (##CONDITIONS$EO_VIRTUAL_INV_ITEM$EVII##)
 <if auturData != 'N'>
 	 and <@dataFilter Table="ES_COMPANY" field= "COMPANY_CODE" alias="EVII" />
	 and <@dataFilter Table="ES_COMPANY" field= "SITE_CODE" alias="EVII" />
	 and <@dataFilter Table="CD_WAREHOUSE" field= "EOVI_WH_CODE" alias="EVII" />
	 and <@dataFilter Table="EB_CUSTOMER" field= "EOVI_OWNER_CODE" alias="EVII" />
 </if>

<if isPlan = 'Y'>
 ORDER BY EVII.EOVI_LOTATT03 asc
</if>
 ]]>
	</sql-query>
</hibernate-mapping>