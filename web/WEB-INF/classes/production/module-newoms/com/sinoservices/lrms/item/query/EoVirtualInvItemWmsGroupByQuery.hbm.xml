<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
 
<hibernate-mapping>
	<sql-query name="EoVirtualInvItemWmsGroupByQuery">
		<![CDATA[
SELECT
    SUM(EVII.P_IN_QTY) AS SUM_P_IN_QTY,
    SUM(EVII.P_OUT_QTY) AS SUM_P_OUT_QTY,
    SUM(EVII.V_IN_QTY) AS SUM_V_IN_QTY,
    SUM(EVII.V_OUT_QTY) AS SUM_V_OUT_QTY,
    SUM(EVII.EOVI_QTY) AS SUM_EOVI_QTY,
    SUM(EVII.EOVI_ONHOLD_QTY) AS SUM_EOVI_ONHOLD_QTY,
    EVII.EOVI_LOTATT04,
    NVL(WM.CODE_ALIAS,T.CODE_ALIAS) AS EOVI_LOTATTNAME04,
    /*仓库*/
    CW.CDWH_NAME WH_NAME,
    /*平台*/
    EC2.ESCO_COMPANY_NAME_CN SITE_NAME,
    EC1.ESCO_COMPANY_NAME_CN COMPANY_NAME,
    EC.EBCU_NAME_CN OWNER_NAME,
    /*有效库存*/
    SUM(EVII.EOVI_QTY)-SUM(EVII.P_OUT_QTY)-SUM(EVII.V_OUT_QTY)-SUM(EVII.EOVI_ONHOLD_QTY) AS SUM_EFFECT_QTY
FROM EO_VIRTUAL_INV_ITEM EVII

LEFT JOIN CD_WAREHOUSE CW
ON CW.WH_CODE = EVII.EOVI_WH_CODE

LEFT JOIN ES_COMPANY EC2
ON EC2.ESCO_COMPANY_NO = EVII.SITE_CODE

 LEFT JOIN ES_COMPANY EC1
  ON EC1.ESCO_COMPANY_NO = EVII.COMPANY_CODE

LEFT JOIN EB_CUSTOMER EC
ON EC.EBCU_CUSTOMER_NO = EVII.EOVI_OWNER_CODE

LEFT JOIN  (select   
                  CODE_ID, 
                  CODE_ALIAS,
                  OWNER_CODE
            from  wm_code_master) wm
        ON  wm.OWNER_CODE =EVII.EOVI_OWNER_CODE 
        AND wm.CODE_ID=EVII.EOVI_LOTATT04
LEFT JOIN  
           (select 
                 eb.EBCD_CODE AS CODE_ID,
                 eb.EBCD_NAME_CN  as CODE_ALIAS      
           from  eb_code_master eb
           where ebcd_dictionary_type = 'SYS_WM_QUALIFY'
               )T
           ON T.CODE_ID=EVII.EOVI_LOTATT04  
  
<if isPlan = 'Y'>
  LEFT JOIN EO_VIRTUAL_IN_OUT_DETAIL EVIOD ON EVIOD.INV_JOB_ID = EVII.EOVI_ID
</if>
  WHERE 1=1
  
<if isPlan = 'Y'>
 <<AND EVIOD.DOC_NO LIKE :docNo>>
 <<AND EVIOD.SKU_LINE_NO LIKE :skuLineNo>>
</if>
 
 <<AND EVII.EOVI_ID LIKE :eoviId>>
 <<AND EVII.CREATOR LIKE :creator>>
 <<AND EVII.CREATE_TIME > :createTimeFrom>>
 <<AND EVII.CREATE_TIME <= :createTimeTo + 1>>
 <<AND EVII.MODIFIER LIKE :modifier>>
 <<AND EVII.MODIFY_TIME > :modifyTimeFrom>>
 <<AND EVII.MODIFY_TIME <= :modifyTimeTo + 1>>
 <<AND EVII.REC_VER LIKE :recVer>>
 <<AND EVII.REC_STATUS LIKE :recStatus>>
 <<AND EVII.ORG_ID LIKE :orgId>>
 <<AND EVII.COMPANY_CODE LIKE :companyCode>>
 <<AND EVII.SITE_CODE LIKE :siteCode>>
 <<AND EVII.SITE_NAME LIKE :siteName>>
 <<AND EVII.EOVI_OWNER_CODE LIKE :eoviOwnerCode>>
 <<AND EVII.EOVI_OWNER_NAME LIKE :eoviOwnerName>>
 <<AND EVII.EOVI_SKU_CODE LIKE :eoviSkuCode>>
 <<AND EVII.EOVI_SKU_NAME LIKE :eoviSkuName>>
 <<AND EVII.P_IN_QTY LIKE :pInQty>>
 <<AND EVII.P_OUT_QTY LIKE :pOutQty>>
 <<AND EVII.V_IN_QTY LIKE :vInQty>>
 <<AND EVII.V_OUT_QTY LIKE :vOutQty>>
 <<AND EVII.EOVI_QTY LIKE :eoviQty>>
 <<AND EVII.EOVI_ONWAY_QTY LIKE :eoviOnwayQty>>
 <<AND EVII.EOVI_STAGE_QTY LIKE :eoviStageQty>>
 <<AND EVII.EOVI_PA_QTY LIKE :eoviPaQty>>
 <<AND EVII.EOVI_ALLOCATED_QTY LIKE :eoviAllocatedQty>>
 <<AND EVII.EOVI_ONHOLD_QTY LIKE :eoviOnholdQty>>
 <<AND EVII.EOVI_QC_QTY LIKE :eoviQcQty>>
 <<AND EVII.EOVI_WH_CODE LIKE :eoviWhCode>>
 <<AND EVII.EOVI_LOT_NUM LIKE :eoviLotNum>>
 <<AND EVII.EOVI_UNIT LIKE :eoviUnit>>
 <<AND EVII.EOVI_PRODUCTION_DATE > :eoviProductionDateFrom>>
 <<AND EVII.EOVI_PRODUCTION_DATE <= :eoviProductionDateTo + 1>>
 <<AND EVII.EOVI_PREALLOCATED_QTY LIKE :eoviPreallocatedQty>>
 
 <<AND EVII.EOVI_LOTATT01 LIKE :eoviLotatt01>>
 <<AND EVII.EOVI_LOTATT02 LIKE :eoviLotatt02>>
 <<AND EVII.EOVI_LOTATT03 LIKE :eoviLotatt03>>
 <<AND nvl(EVII.EOVI_LOTATT04,'#') LIKE :eoviLotatt04>>
 <<AND nvl(EVII.EOVI_LOTATT05,'#') LIKE :eoviLotatt05>>
 <<AND nvl(EVII.EOVI_LOTATT06,'#') LIKE :eoviLotatt06>>
 <<AND nvl(EVII.EOVI_LOTATT07,'#') LIKE :eoviLotatt07>>
 <<AND nvl(EVII.EOVI_LOTATT08,'#') LIKE :eoviLotatt08>>
 <<AND nvl(EVII.EOVI_LOTATT09,'#') LIKE :eoviLotatt09>>
 <<AND nvl(EVII.EOVI_LOTATT10,'#') LIKE :eoviLotatt10>>
 <<AND nvl(EVII.EOVI_LOTATT11,'#') LIKE :eoviLotatt11>>
 <<AND nvl(EVII.EOVI_LOTATT12,'#') LIKE :eoviLotatt12>>
 <<AND EVII.TIME_ZONE LIKE :timeZone>>
 <<AND EVII.DEF1 LIKE :def1>>
 <<AND EVII.DEF2 LIKE :def2>>
 <<AND EVII.DEF3 LIKE :def3>>
 <<AND EVII.DEF4 LIKE :def4>>
 <<AND EVII.DEF5 LIKE :def5>>
 <<AND EVII.EOVI_WH_CODE IN (:whCodeNos)>>
 <<AND EVII.SITE_CODE IN (:siteCodeNos)>>
 <<AND EC.IS_GROUP_CUSTOMER LIKE :isGroupCustomer>>
 
 <<AND EC.Ebcu_Bu_Code = :ebcuBuCode>>
 <<AND EC.is_agent =:isAgent >>
 <<AND EC.is_sale_company =:isSaleCompany>>
 
 and <@dataFilter Table="ES_COMPANY" field= "COMPANY_CODE" alias="EVII" />
 and <@dataFilter Table="ES_COMPANY" field= "SITE_CODE" alias="EVII" />
 and <@dataFilter Table="CD_WAREHOUSE" field= "EOVI_WH_CODE" alias="EVII" />
 and <@dataFilter Table="EB_CUSTOMER" field= "EOVI_OWNER_CODE" alias="EVII" />
 and (##CONDITIONS$EO_VIRTUAL_INV_ITEM$EVII##)
<if isPlan = 'Y'>
 ORDER BY EVII.EOVI_LOTATT03 asc
</if>
GROUP BY EVII.EOVI_LOTATT04,WM.CODE_ALIAS,T.CODE_ALIAS,CW.CDWH_NAME,EC2.ESCO_COMPANY_NAME_CN,EC.EBCU_NAME_CN,EC1.ESCO_COMPANY_NAME_CN
HAVING (SUM(EVII.EOVI_QTY) > 0 or SUM(EVII.EOVI_ONHOLD_QTY) > 0 or SUM(EVII.P_IN_QTY) > 0 or SUM(EVII.P_OUT_QTY) > 0 or SUM(EVII.V_IN_QTY) > 0 or SUM(EVII.V_OUT_QTY) > 0)
 ]]>
	</sql-query>
</hibernate-mapping>