<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="EoExceptionRecordQuery">
		<![CDATA[

SELECT
rownum,
EBEO.EBEO_ID,
EBEO.EBEO_NO,
EBEO.EBEO_SYS_NO,
EBEO.EBEO_TRS_NO,
EBEO.EBEO_STATUS,
EBEO.EBEO_NO_TYPE,
EBEO.EBEO_EBEP_CODE,
EBEO.EBEO_EBEP_NAME_CN,
EBEO.EBEO_OPERATOR,
EBEO.EBEO_OPERAT_TIME,
EBEO.EBEO_OPERAT_REASON,
EBEO.EBEO_RESPONSIBLE_PERSON,
EBEO.EBEO_RESPONSIBLE_CONTACT,
EBEO.EBEO_START_PERSON,
EBEO.EBEO_START_TIME,
EBEO.EBEO_CONTENT,
EBEO.ORG_ID,
EBEO.CREATOR,
EBEO.CREATE_TIME,
EBEO.MODIFIER,
EBEO.MODIFY_TIME,
EBEO.REC_VER,
EBEO.REC_STATUS,
EBEO.EBEO_MODULE_TYPE,

EBEO.COMPANY_CODE,
EBEO.SITE_CODE,
EBEO.EBES_SOURCE_SYS,
EBEO.EBES_SOURCE_SYS_TYPE,
EBEO.EBES_CUSTOMER_NO,
EBEO.EBES_REMARK,

EOOR.EOOR_LOGISTIC_NO,
EOOR.EOOR_STATUS_CODE,
EOOR.EOOR_CUSTOMER_CODE,
EOOR.EOOR_CUSTOMER_NAME,
EOOR.EOOR_ORDER_BIG_TYPE,
(SELECT ESCO_COMPANY_NAME_CN FROM ES_COMPANY 
WHERE ESCO_COMPANY_TYPE = 'C'  AND ESCO_STATUS = 'ENABLE'
AND ESCO_COMPANY_NO=EBEO.COMPANY_CODE) AS COMPANY_NAME,
(SELECT ESCO_COMPANY_NAME_CN FROM ES_COMPANY 
 WHERE ESCO_COMPANY_TYPE = 'P' 
   AND ESCO_STATUS = 'ENABLE' AND SITE_CODE=EBEO.SITE_CODE) AS SITE_NAME,
ESUS.ESUS_USER_NAME_CN AS ESUS_CREATOR_USER_NAME

FROM EB_EXCEPTION_RECORD EBEO
LEFT JOIN EO_ORDER EOOR ON EOOR.EOOR_ORDER_NO=EBEO.EBEO_SYS_NO AND EBEO.ORG_ID=EOOR.ORG_ID
LEFT JOIN ES_USER ESUS ON EBEO.CREATOR=ESUS.ESUS_ID
WHERE 1=1
AND EBEO.EBEO_MODULE_TYPE=0
AND <@dataFilter Table="EO_ORDER" fiEld= "COMPANY_CODE" aLias="EOOR" />
AND 
(
<@dataFilter tAble="EO_ORDER" fiEld= "SITE_CODE" aLias="EOOR" />
OR
<@dataFilter tAble="EO_ORDER" fiEld= "TMS_SITE_CODE" aLias="EOOR" />
)
 AND <@dataFilter Table="EO_ORDER" fiEld= "EOOR_CUSTOMER_CODE" aLias="EOOR" />
<<AND EBEO.EBEO_NO LIKE :ebeoNo >>
<<AND EBEO.EBEO_SYS_NO LIKE :ebeoSysNo >>
<<AND EOOR.EOOR_LOGISTIC_NO LIKE :eoorLogisticNo >>
<<AND EOOR.EOOR_STATUS_CODE LIKE :eoorStatusCode>>
<<AND EBEO.EBES_SOURCE_SYS_TYPE LIKE :ebesSourceSysType>>
<<AND EBEO.EBEO_STATUS LIKE :ebeoStatus>>
<<AND EOOR.EOOR_CUSTOMER_CODE LIKE :eoorCustomerCode>>
<<AND EBEO.COMPANY_CODE LIKE :companyCode>>
<<AND EBEO.SITE_CODE LIKE :siteCode>>
<<AND EBEO.EBEO_OPERAT_TIME >=:ebeoOperatTimeFrom>>
<<AND EBEO.EBEO_OPERAT_TIME <=:ebeoOperatTimeTo>>
<<AND EBEO.CREATE_TIME >=:createTimeFrom>>
<<AND EBEO.CREATE_TIME <=:createTimeTo>>
<<AND EBEO.EBEO_SYS_NO IN (:ebeoSysNos)>>
<#if limitRowNum == 1>
   AND rownum<=:rowNumSize
</#if>
ORDER BY EBEO.MODIFY_TIME DESC

		]]>
	</sql-query>
</hibernate-mapping>
