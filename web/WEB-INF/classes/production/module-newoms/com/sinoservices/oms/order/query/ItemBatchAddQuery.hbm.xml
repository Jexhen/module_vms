<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="ItemBatchAddQuery">
		<![CDATA[

SELECT INV.SKU_CODE AS SKU_CODE,
       INV.SKU_NAME AS SKU_NAME,
       INV.OWNER_CODE AS OWNER_CODE,
       INV.OWNER_NAME AS OWNER_NAME,
       INV.WH_CODE AS WH_CODE,
       INV.WH_NAME AS WH_NAME,
       SUM(INV.QTY) AS QTY,
       SUM(INV.QTY_IN) AS IN_QTY,
       SUM(INV.QTY_OUT) AS OUT_QTY,
       SUM(INV.QTY) + SUM(INV.QTY_IN) - SUM(INV.QTY_OUT) AS AVAI_QTY,
       INV.LOT_NUM AS LOT_NUM,
       INV.LOTATT01 AS LOATATO11,
       INV.LOTATT02,
       INV.LOTATT03,
       INV.LOTATT04,
       INV.LOTATT05,
       INV.LOTATT06,
       INV.LOTATT07,
       INV.LOTATT08,
       INV.LOTATT09,
       INV.LOTATT10,
       INV.LOTATT11,
       INV.LOTATT12,
       INV.SKU_NAME_EN,
       INV.SKU_SHORT_NAME,
       INV.SKU_PACKAGE_CODE,
       INV.SKU_PACKAGE_NAME,
       INV.SKU_BARCODE,
       (CASE
         WHEN SUM(INV.QTY) + SUM(INV.QTY_IN) - SUM(INV.QTY_OUT) > 0 THEN
          'Y'
         ELSE
          'N'
       END) IS_INV_ITEM,
       '' AS MAX_ROW,
       INV.CDPA_CODE, 
       INV.CDPA_FORMAT,
       INV.CDPR_UNIT, 
       INV.CDPR_DESC,
       INV.CDPR_QUANTITY,
       INV.CDCM_MIN_TEMP,
       INV.CDCM_MAX_TEMP,
       INV.CDCM_WEIGHT,
       INV.CDCM_NET_WEIGHT,
       INV.CDCM_STOCK_UNIT_PRICE,
       INV.CDCM_TEMP_LEVEL,
       INV.CDCM_CUBE,
       INV.CDCM_PERIOD_OF_VALIDITY,
       INV.CDCM_PROVIDE_CUST_CODE,
       INV.EBCU_NAME_CN AS CDCM_PROVIDE_CUST_NAME,
       INV.CDCM_VALIDITY_UNIT
  FROM (SELECT M.CDCM_MATERIAL_NO AS SKU_CODE,
               M.CDCM_NAME_CN AS SKU_NAME,
               V.EOVI_OWNER_CODE AS OWNER_CODE,
               V.EOVI_OWNER_NAME AS OWNER_NAME,
               V.EOVI_WH_CODE AS WH_CODE,
               W.CDWH_NAME AS WH_NAME,
               SUM(NVL(V.EOVI_QTY, 0)) AS QTY,
               0 AS QTY_IN,
               0 AS QTY_OUT,
               V.EOVI_LOT_NUM AS LOT_NUM,
               V.EOVI_LOTATT01 AS LOTATT01,
               V.EOVI_LOTATT02 AS LOTATT02,
               V.EOVI_LOTATT03 AS LOTATT03,
               V.EOVI_LOTATT04 AS LOTATT04,
               V.EOVI_LOTATT05 AS LOTATT05,
               V.EOVI_LOTATT06 AS LOTATT06,
               V.EOVI_LOTATT07 AS LOTATT07,
               V.EOVI_LOTATT08 AS LOTATT08,
               V.EOVI_LOTATT09 AS LOTATT09,
               V.EOVI_LOTATT10 AS LOTATT10,
               V.EOVI_LOTATT11 AS LOTATT11,
               V.EOVI_LOTATT12 AS LOTATT12,
               M.CDCM_NAME_EN AS SKU_NAME_EN,
               M.CDCM_SHORT_NAME AS SKU_SHORT_NAME,
               M.CDCM_PACKAGE_CODE AS SKU_PACKAGE_CODE,
               M.CDCM_BARCODE AS SKU_BARCODE,
               '' AS MAX_ROW,
               CDWP.CDPA_CODE, 
               CDWP.CDPA_FORMAT AS SKU_PACKAGE_NAME,
               CDWP.CDPA_FORMAT,
               CDPR.CDPR_UNIT, 
               CDPR.CDPR_DESC,
               CDPR.CDPR_QUANTITY,
               M.CDCM_MIN_TEMP,
               M.CDCM_MAX_TEMP,
               M.CDCM_WEIGHT,
               M.CDCM_NET_WEIGHT,
               M.CDCM_STOCK_UNIT_PRICE,
               M.CDCM_TEMP_LEVEL,
               M.CDCM_CUBE,
               M.CDCM_PERIOD_OF_VALIDITY,
               M.CDCM_PROVIDE_CUST_CODE,
               EBCU.EBCU_NAME_CN,
        	   M.CDCM_VALIDITY_UNIT,
        	   M.ORG_ID
          FROM CD_COMMON_MATERIAL M
          LEFT JOIN EO_VIRTUAL_INV_ITEM V
            ON V.EOVI_SKU_CODE = M.CDCM_MATERIAL_NO
           AND V.ORG_ID = M.ORG_ID
           AND V.REC_STATUS = 0
          LEFT JOIN CD_WAREHOUSE W
            ON W.CDWH_CODE = V.EOVI_WH_CODE
           AND W.ORG_ID = V.ORG_ID
           AND W.REC_STATUS = 0
          LEFT JOIN CD_WH_PACKAGE CDWP
            ON M.CDCM_PACKAGE_CODE = CDWP.CDPA_CODE
           AND CDWP.REC_STATUS = 0
           AND M.ORG_ID = CDWP.ORG_ID
          LEFT JOIN CD_TS_PACKAGE_RELATION CDPS
            ON CDPS.CDPS_CDPA_CODE = CDWP.CDPA_CODE
           AND CDPS.ORG_ID = CDWP.ORG_ID
           AND CDPS.CDPS_IS_DEFAULT = 'Y'
          LEFT JOIN CD_WH_PACKAGE_RELATION CDPR
            ON CDPS.CDPS_UNIT = CDPR.CDPR_UNIT
           AND CDPR.ORG_ID = CDPS.ORG_ID
           AND CDPR.CDPR_CDPA_PM_CODE = CDWP.PM_CODE
           AND CDPR.REC_STATUS = 0
          LEFT JOIN EB_CUSTOMER EBCU
            ON M.CDCM_PROVIDE_CUST_CODE = EBCU.PM_CODE
           AND EBCU.REC_STATUS = 0
           AND M.ORG_ID = EBCU.ORG_ID
         WHERE M.REC_STATUS = 0
         GROUP BY M.CDCM_MATERIAL_NO,
                  M.CDCM_NAME_CN,
                  V.EOVI_OWNER_CODE,
                  V.EOVI_OWNER_NAME,
                  V.EOVI_WH_CODE,
                  W.CDWH_NAME,
                  V.EOVI_LOT_NUM,
                  V.EOVI_LOTATT01,
                  V.EOVI_LOTATT02,
                  V.EOVI_LOTATT03,
                  V.EOVI_LOTATT04,
                  V.EOVI_LOTATT05,
                  V.EOVI_LOTATT06,
                  V.EOVI_LOTATT07,
                  V.EOVI_LOTATT08,
                  V.EOVI_LOTATT09,
                  V.EOVI_LOTATT10,
                  V.EOVI_LOTATT11,
                  V.EOVI_LOTATT12,
                  M.CDCM_NAME_EN,
                  M.CDCM_SHORT_NAME,
                  M.CDCM_PACKAGE_CODE,
                  M.CDCM_BARCODE,
                  CDWP.CDPA_CODE, 
                  CDWP.CDPA_FORMAT,
                  CDPR.CDPR_UNIT, 
                  CDPR.CDPR_DESC,
                  CDPR.CDPR_QUANTITY,
                  M.CDCM_MIN_TEMP,
                  M.CDCM_MAX_TEMP,
                  M.CDCM_WEIGHT,
                  M.CDCM_NET_WEIGHT,
                  M.CDCM_STOCK_UNIT_PRICE,
                  M.CDCM_TEMP_LEVEL,
                  M.CDCM_CUBE,
                  M.CDCM_PERIOD_OF_VALIDITY,
                  M.CDCM_PROVIDE_CUST_CODE,
                  EBCU.EBCU_NAME_CN,
                  M.CDCM_VALIDITY_UNIT,
                  M.ORG_ID
                  
        UNION ALL
        
        SELECT M.CDCM_MATERIAL_NO AS SKU_CODE,
               M.CDCM_NAME_CN AS SKU_NAME,
               O.EOII_CUSTOMER_CODE AS OWNER_CODE,
               O.EOII_CUSTOMER_NAME AS OWNER_NAME,
               O.EOII_WH_CODE AS WH_CODE,
               W.CDWH_NAME AS WH_NAME,
               0 AS QTY,
               SUM(CASE
                     WHEN O.EOII_EXPECTED_TYPE = 'I' THEN
                      NVL(O.EOII_EXPECTED_QTY, 0)
                     ELSE
                      0
                   END) AS QTY_IN,
               SUM(CASE
                     WHEN O.EOII_EXPECTED_TYPE = 'O' THEN
                      NVL(O.EOII_EXPECTED_QTY, 0)
                     ELSE
                      0
                   END) AS QTY_OUT,
               O.EOII_LOT_NUM AS LOT_NUM,
               O.EOII_LOTATT01 AS LOTATT01,
               '' AS LOTATT02,
               '' AS LOTATT03,
               '' AS LOTATT04,
               '' AS LOTATT05,
               '' AS LOTATT06,
               '' AS LOTATT07,
               '' AS LOTATT08,
               '' AS LOTATT09,
               '' AS LOTATT10,
               '' AS LOTATT11,
               '' AS LOTATT12,
               /*
               V.EOVI_LOTATT02 AS LOTATT02,
               V.EOVI_LOTATT03 AS LOTATT03,
               V.EOVI_LOTATT04 AS LOTATT04,
               V.EOVI_LOTATT05 AS LOTATT05,
               V.EOVI_LOTATT06 AS LOTATT06,
               V.EOVI_LOTATT07 AS LOTATT07,
               V.EOVI_LOTATT08 AS LOTATT08,
               V.EOVI_LOTATT09 AS LOTATT09,
               V.EOVI_LOTATT10 AS LOTATT10,
               V.EOVI_LOTATT11 AS LOTATT11,
               V.EOVI_LOTATT12 AS LOTATT12,
               */
               M.CDCM_NAME_EN AS SKU_NAME_EN,
               M.CDCM_SHORT_NAME AS SKU_SHORT_NAME,
               M.CDCM_PACKAGE_CODE AS SKU_PACKAGE_CODE,
               M.CDCM_BARCODE AS SKU_BARCODE,
               '' AS MAX_ROW,
               CDWP.CDPA_CODE, 
               CDWP.CDPA_FORMAT  AS SKU_PACKAGE_NAME,
               CDWP.CDPA_FORMAT,
               CDPR.CDPR_UNIT, 
               CDPR.CDPR_DESC,
               CDPR.CDPR_QUANTITY,
               M.CDCM_MIN_TEMP,
               M.CDCM_MAX_TEMP,
               M.CDCM_WEIGHT,
               M.CDCM_NET_WEIGHT,
               M.CDCM_STOCK_UNIT_PRICE,
               M.CDCM_TEMP_LEVEL,
               M.CDCM_CUBE,
               M.CDCM_PERIOD_OF_VALIDITY,
               M.CDCM_PROVIDE_CUST_CODE,
               EBCU.EBCU_NAME_CN AS CDCM_PROVIDE_CUST_NAME,
               M.CDCM_VALIDITY_UNIT,
               M.ORG_ID
          FROM CD_COMMON_MATERIAL M
          /*
          LEFT JOIN EO_VIRTUAL_INV_ITEM V
            ON V.EOVI_SKU_CODE = M.CDCM_MATERIAL_NO
           AND V.ORG_ID = M.ORG_ID
           AND V.REC_STATUS = 0
          */
          LEFT JOIN EO_ONWAY_INV_ITEM O
            ON O.EOII_SKU_CODE = M.CDCM_MATERIAL_NO
           AND O.ORG_ID = M.ORG_ID
           AND O.REC_STATUS = 0
          LEFT JOIN CD_WAREHOUSE W
            ON W.CDWH_CODE = O.EOII_WH_CODE
           AND W.ORG_ID = O.ORG_ID
           AND W.REC_STATUS = 0
          LEFT JOIN CD_WH_PACKAGE CDWP
            ON M.CDCM_PACKAGE_CODE = CDWP.CDPA_CODE
           AND CDWP.REC_STATUS = 0
           AND M.ORG_ID = CDWP.ORG_ID
          LEFT JOIN CD_TS_PACKAGE_RELATION CDPS
            ON CDPS.CDPS_CDPA_CODE = CDWP.CDPA_CODE
           AND CDPS.ORG_ID = CDWP.ORG_ID
           AND CDPS.CDPS_IS_DEFAULT = 'Y'
          LEFT JOIN CD_WH_PACKAGE_RELATION CDPR
            ON CDPS.CDPS_UNIT = CDPR.CDPR_UNIT
           AND CDPR.ORG_ID = CDPS.ORG_ID
           AND CDPR.CDPR_CDPA_PM_CODE = CDWP.PM_CODE
           AND CDPR.REC_STATUS = 0
          LEFT JOIN EB_CUSTOMER EBCU
            ON M.CDCM_PROVIDE_CUST_CODE = EBCU.PM_CODE
           AND EBCU.REC_STATUS = 0
           AND M.ORG_ID = EBCU.ORG_ID
         WHERE M.REC_STATUS = 0
         GROUP BY M.CDCM_MATERIAL_NO,
                  M.CDCM_NAME_CN,
                  O.EOII_CUSTOMER_CODE,
                  O.EOII_CUSTOMER_NAME,
                  O.EOII_WH_CODE,
                  W.CDWH_NAME,
                  O.EOII_LOT_NUM,
                  O.EOII_LOTATT01,
                  /*
                  V.EOVI_LOTATT02,
                  V.EOVI_LOTATT03,
                  V.EOVI_LOTATT04,
                  V.EOVI_LOTATT05,
                  V.EOVI_LOTATT06,
                  V.EOVI_LOTATT07,
                  V.EOVI_LOTATT08,
                  V.EOVI_LOTATT09,
                  V.EOVI_LOTATT10,
                  V.EOVI_LOTATT11,
                  V.EOVI_LOTATT12,
                  */
                  M.CDCM_NAME_EN,
                  M.CDCM_SHORT_NAME,
                  M.CDCM_PACKAGE_CODE,
                  M.CDCM_BARCODE,
                  CDWP.CDPA_CODE, 
                  CDWP.CDPA_FORMAT,
                  CDPR.CDPR_UNIT, 
                  CDPR.CDPR_DESC,
                  CDPR.CDPR_QUANTITY,
                  M.CDCM_MIN_TEMP,
                  M.CDCM_MAX_TEMP,
                  M.CDCM_WEIGHT,
                  M.CDCM_NET_WEIGHT,
                  M.CDCM_STOCK_UNIT_PRICE,
                  M.CDCM_TEMP_LEVEL,
                  M.CDCM_CUBE,
                  M.CDCM_PERIOD_OF_VALIDITY,
                  M.CDCM_PROVIDE_CUST_CODE,
                  EBCU.EBCU_NAME_CN,
                  M.CDCM_VALIDITY_UNIT,
                  M.ORG_ID) INV
 WHERE 1 = 1
   << AND INV.SKU_CODE LIKE  :skuCode >>
  << AND INV.SKU_NAME LIKE  :skuName >>
  << AND INV.SKU_NAME_EN LIKE  :skuNameEn >>
  << AND INV.OWNER_CODE LIKE :ownerCode >>
  << AND INV.OWNER_NAME LIKE  :ownerName >>
  << AND INV.SKU_NAME_EN LIKE  :skuNameEn >>
  << AND INV.SKU_SHORT_NAME LIKE  :skuShortName >>
  << AND INV.SKU_PACKAGE_CODE LIKE :skuPackageCode >>
  << AND INV.SKU_PACKAGE_NAME LIKE  :skuPackageName >>
  << AND INV.SKU_BARCODE LIKE  :skuBarcode >>
  << AND INV.ORG_ID = :orgId >>
 GROUP BY INV.SKU_CODE,
          INV.SKU_NAME,
          INV.OWNER_CODE,
          INV.OWNER_NAME,
          INV.WH_CODE,
          INV.WH_NAME,
          INV.LOT_NUM,
          INV.LOTATT01,
          INV.LOTATT02,
       	  INV.LOTATT03,
          INV.LOTATT04,
          INV.LOTATT05,
          INV.LOTATT06,
          INV.LOTATT07,
          INV.LOTATT08,
          INV.LOTATT09,
          INV.LOTATT10,
          INV.LOTATT11,
          INV.LOTATT12,
          INV.SKU_NAME_EN,
          INV.SKU_SHORT_NAME,
          INV.SKU_PACKAGE_CODE,
          INV.SKU_PACKAGE_NAME,
          INV.SKU_BARCODE,
          INV.CDPA_CODE, 
          INV.CDPA_FORMAT,
          INV.CDPR_UNIT, 
          INV.CDPR_DESC,
          INV.CDPR_QUANTITY,
          INV.CDCM_MIN_TEMP,
          INV.CDCM_MAX_TEMP,
          INV.CDCM_WEIGHT,
          INV.CDCM_NET_WEIGHT,
          INV.CDCM_STOCK_UNIT_PRICE,
          INV.CDCM_TEMP_LEVEL,
          INV.CDCM_CUBE,
          INV.CDCM_PERIOD_OF_VALIDITY,
          INV.CDCM_PROVIDE_CUST_CODE,
          INV.EBCU_NAME_CN,
          INV.CDCM_VALIDITY_UNIT
 	HAVING 1 =1
		  <if isInvItem == 'N'>
			  AND SUM(INV.QTY) + SUM(INV.QTY_IN) - SUM(INV.QTY_OUT) > 0
		  </if>
  ORDER BY INV.SKU_NAME,INV.LOTATT01
		]]>
	</sql-query>
</hibernate-mapping>
