<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="WarehouseVirtualQuery">
		<![CDATA[

  SELECT EOWO.EOWO_WORK_ORDER_NO,
       EOWO.EOWO_SHIPPER_FWH_CODE,
       EOWO.EOWO_CUSTOMER_CODE,
       EOWO.SITE_CODE,
       EOWO.EOWO_UPSTREAM_SYS,
       EOWI.EOWI_CODE,
       EOWI.EOWI_NAME,
       EOWI.EOWI_PACKAGE_QUANTITY,
       EOVI.EOVI_WH_CODE,
       T.EOVI_WH_NAME,
       (EOVI.EOVI_QTY - EOVI.P_OUT_QTY - EOVI.V_OUT_QTY - EOVI.EOVI_ONHOLD_QTY) AS EFFECTIVE_QTY
  FROM EO_WORK_ITEM EOWI --任务商品表
  LEFT JOIN EO_WORK_ORDER EOWO
    ON EOWO.EOWO_WORK_ORDER_NO = EOWI.EOWI_WORK_ORDER_NO
  LEFT JOIN (SELECT CDWH.SITE_CODE AS SITE_CODE,
                    '' AS CUST_WH_CODE,
                    CDWH.WH_CODE AS WH_CODE,
                    CDWH.CDWH_NAME AS EOVI_WH_NAME,
                    'P' AS UPSTREAM_SYS
               FROM CD_WAREHOUSE CDWH
             UNION ALL
             SELECT MISH.SITE_CODE AS SITE_CODE,
                    MISH.CUST_WH_CODE AS CUST_WH_CODE,
                    MISH.WH_CODE AS WH_CODE,
                    MISH.WH_NAME AS WH_NAME,
                    'GOMS' AS UPSTREAM_SYS
               FROM MID_SITE_WH_CONTROL MISH) T
    ON T.SITE_CODE = EOWO.SITE_CODE
   AND T.UPSTREAM_SYS = NVL(EOWO.EOWO_UPSTREAM_SYS, 'P')
  LEFT JOIN EO_VIRTUAL_INV_ITEM EOVI
    ON EOWI.EOWI_CODE = EOVI.EOVI_SKU_CODE
   AND EOVI.EOVI_WH_CODE = T.WH_CODE
   AND EOVI.EOVI_OWNER_CODE=EOWO.EOWO_CUSTOMER_CODE

 WHERE 1 = 1
 	AND (EOVI.EOVI_QTY - EOVI.P_OUT_QTY - EOVI.V_OUT_QTY - EOVI.EOVI_ONHOLD_QTY)>0
   << AND EOWI.EOWI_WORK_ORDER_NO = :eowoWorkOrderNo >>
 ORDER BY T.WH_CODE, EOWI.EOWI_CODE
	
		]]>
	</sql-query>
</hibernate-mapping>
