<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC 
	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="EoOrderMileStoneStatusQuery">
		<![CDATA[

SELECT  
     EOOM.EOOM_ID,
     EOOM.EOOM_SEQUENCE,
     EOOM.EOOM_ORDER_NO,
     EOOM.EOOM_MILESTONE_CODE,
     EOOM.EOOM_MILESTONE_NAME,
     EOOM.EOOM_STATUS_CODE,
     EOOM.EOOM_STATUS_NAME,
     EOOM.CREATOR,
     EOOM.CREATE_TIME,
     
     EOOM.EOOM_PLAN_TIME,
     EOOM.EOOM_ACTUAL_TIME,
     EOOM.EOOM_REMARK_NAME_A,
     EOOM.EOOM_REMARK_VALUE_A,
     EOOM.EOOM_REMARK_NAME_B,
     EOOM.EOOM_REMARK_VALUE_B,
     EOOM.EOOM_REMARK_NAME_C,
     EOOM.EOOM_REMARK_VALUE_C,
     EOOM.EOOM_REMARK_NAME_D,
     EOOM.EOOM_REMARK_VALUE_D,
     EOOM.EOOM_REMARK_NAME_E,
     EOOM.EOOM_REMARK_VALUE_E,
     EOOM.EOOM_WORK_NO,
     EOOM.EOOM_WORK_TYPE_CODE,
     EOOM.EOOM_WORK_TYPE_NAME,
     EOOM.EOOM_OPERATOR_CODE,
     EOOM.EOOM_OPERATOR_NAME,
     EOOM.EOOM_LOCATION_CODE,
     EOOM.EOOM_LOCATION_NAME,
     EOOM.EOOM_REMARK,
     (CASE WHEN EOOM.EOOM_OPERATOR_NAME IS NOT NULL THEN EOOM.EOOM_OPERATOR_NAME ELSE 
     (SELECT ESUS.ESUS_USER_NAME_CN FROM ES_USER ESUS WHERE ESUS.ESUS_ISENABLE='Y' AND EOOM.ORG_ID=ESUS.ESUS_ESCO_ID AND EOOM.EOOM_OPERATOR_CODE=ESUS.ESUS_LOGIN_NAME ) END)
     AS ESUS_USER_NAME_CN
     FROM EO_ORDER_MILESTONE EOOM LEFT JOIN EO_ORDER EOOR ON EOOM.EOOM_ORDER_NO=EOOR.EOOR_ORDER_NO
     AND EOOM.ORG_ID=EOOR.ORG_ID AND EOOR.REC_STATUS=0
     WHERE 1=1
     AND EOOM.REC_STATUS=0
     AND EXISTS (SELECT 1 FROM EO_ORDER EOOR WHERE EOOR.EOOR_ORDER_NO=EOOM.EOOM_ORDER_NO AND NVL(EOOR.EOOR_SPLIT_FLAG,'N')='N' AND EOOR.ORG_ID=EOOM.ORG_ID)
     <<AND EOOM.ORG_ID=:orgId>>
     <<AND EOOM.EOOM_ORDER_NO LIKE :eoomOrderNo>> 
     ORDER BY EOOM.EOOM_SEQUENCE,EOOM.EOOM_ACTUAL_TIME
		]]>
	</sql-query>
</hibernate-mapping>
